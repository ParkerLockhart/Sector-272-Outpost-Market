name: Pre-Merge Checks
on: 
      pull_request:
            types: [opened, synchronize, edited, reopened]

jobs:
      uses: actions/checkout@v2
      build:
            name: build
      runs-on: ubuntu-latest
      env:
            PGHOST: localhost
            PGUSER: Sector-272-Outpost-Market
            PGPASSWORD: ''
            RAILSENV: test
      services:
            postgres:
              image: postgres
              ports:
                - "5432:5432"
              env:
                POSTGRES_DB: Sector-272-Outpost-Market-test
                POSTGRES_USER: Sector-272-Outpost-Market
                POSTGRES_PASSWORD: ''
              options: >-
                --health-cmd pg_isready
                --health-interval 10s
                --health-timeout 5s
                --health-retries 5
            steps:
                  - name: Setup Ruby
                        uses:ruby/setup-ruby@v1.99.0
                    with: 
                      ruby-version: 2.7.2
                      bundler-cache: true
                    run: bundle install
                  - name: Setup DB
                    run: bundle exec rails db:create RAILS_ENV=test
                    run: bundle exec rails db:migrate RAILS_ENV=test
              test:
                  name: test
                  runs-on: ubuntu-latest
                  needs: build
                  steps:
                   - run: bundle exec rspec
